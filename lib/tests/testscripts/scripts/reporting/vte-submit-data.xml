<?xml version="1.0" encoding="UTF-8"?>

<TestScript xmlns="http://hl7.org/fhir">
    <id value="vte-submit-data"/>
    <url value="http://example.com"/>
    <name value="Submit Data VTE-1"/>
    <status value="draft"/>
    <date value="2019-04-12"/>
    <publisher value="MITRE"/>
    <contact>
        <name value="Matthew Gramigna"/>
        <telecom>
            <system value="email"/>
            <value value="mgramigna@mitre.org"/>
            <use value="work"/>
        </telecom>
    </contact>
    <description value="Tests the $submit-data operation for the FHIR VTE Measure"/>

    <fixture id="library-fhir-model-definition">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-fhir-model-definition.json"/>
        </resource>
    </fixture>
    <fixture id="library-fhir-helpers">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-fhir-helpers.json"/>
        </resource>
    </fixture>
    <fixture id="library-mat-global-common-functions-FHIR">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-mat-global-common-functions-FHIR.json"/>
        </resource>
    </fixture>
    <fixture id="library-supplemental-data-elements-FHIR">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-supplemental-data-elements-FHIR.json"/>
        </resource>
    </fixture>
    <fixture id="library-vte-icu-FHIR">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-vte-icu-FHIR.json"/>
        </resource>
    </fixture>
    <fixture id="library-vte-1-FHIR">
        <resource>
            <reference value="./_reference/resources/Library/vte/library-vte-1-FHIR.json"/>
        </resource>
    </fixture>
    <fixture id="measure-vte-1-FHIR">
        <resource>
            <reference value="./_reference/resources/Measure/measure-vte-1-FHIR.json"/>
        </resource>
    </fixture>
    <fixture id="vte-submit-data-input">
        <resource>
            <reference value="./_reference/resources/vte-submit-data-parameters.json"/>
        </resource>
    </fixture>

    <setup>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-fhir-model-definition"/>
                <sourceId value="library-fhir-model-definition"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-fhir-helpers"/>
                <sourceId value="library-fhir-helpers"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-mat-global-common-functions-FHIR"/>
                <sourceId value="library-mat-global-common-functions-FHIR"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-supplemental-data-elements-FHIR"/>
                <sourceId value="library-supplemental-data-elements-FHIR"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-vte-icu-FHIR"/>
                <sourceId value="library-vte-icu-FHIR"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Library"/>
                <description value="Update or create a library on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/library-vte-1-FHIR"/>
                <sourceId value="library-vte-1-FHIR"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="update"/>
                </type>
                <resource value="Measure"/>
                <description value="Create a measure on the server"/>
                <accept value="json"/>
                <contentType value="json"/>
                <params value="/measure-vte-1-FHIR"/>
                <sourceId value="measure-vte-1-FHIR"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK) or 201(Created)."/>
                <operator value="in"/>
                <responseCode value="200,201"/>
            </assert>
        </action>
    </setup>

    <test id="01-Measure-Submit-Data">
        <name value="01-Measure-Submit-Data"/>
        <description value="Submit the required data for a known Measure using HTTP POST. Expected response is 200 (OK)."/>
        <action>
            <operation>
                <type>
                    <code value="submit-data"/>
                </type>
                <resource value="Measure"/>
                <description value="Measure $submit-data operation for a known Measure."/>
                <accept value="json"/>
                <contentType value="json"/>
                <encodeRequestUrl value="true"/>
                <params value="measure-vte-1-FHIR"/>
                <sourceId value="vte-submit-data-input"/>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <response value="okay"/>
            </assert>
        </action>
    </test>
</TestScript>